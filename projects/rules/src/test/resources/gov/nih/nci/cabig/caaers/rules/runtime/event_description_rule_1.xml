<?xml version="1.0" encoding="UTF-8"?>
<package  name="gov.nih.nci.cabig.caaers.rules.reporting_description_section" xmlns="http://drools.org/drools-3.0" xmlns:xs="http://www.w3.org/2001/XMLSchema-instance" xs:schemaLocation="http://drools.org/drools-3.0 drools-3.0.xsd">
	<global type="gov.nih.nci.cabig.caaers.rules.runtime.RuleContext" identifier="ruleContext"/>
	<global type="gov.nih.nci.cabig.caaers.rules.runtime.action.ActionDispatcher" identifier="actionDispatcher"/>
	<import name="gov.nih.nci.cabig.caaers.domain.*"/>
	
	<!-- ==========================================================================
	RuleName : DSC_BR1A_CHK
	Rule : "'Date of Recovery or Death' must be provided if 'Present Status' has one of following values:
			Fatal/Died
			Recovered/Resolved without Sequelae
			Recovered/Resolved with Sequelae"
	Error Code : DSC_BR1A_ERR
	Error Message : DATE_OF_RECOVERY_DEATH must be provided for the provided PRESENT_STATUS value.
	============================================================================= -->
	<rule name="DSC_BR1A_CHK">
		<lhs>
			<column identifier="aeReport" object-type="gov.nih.nci.cabig.caaers.domain.ExpeditedAdverseEventReport"/>
			<column identifier="errors" object-type="gov.nih.nci.cabig.caaers.validation.ValidationErrors"/>
			
			<eval>aeReport.getResponseDescription().getPresentStatus() != null</eval>
		
			<or>
				<eval>aeReport.getResponseDescription().getPresentStatus().getDisplayName() == "Fatal/Died"</eval>
				<eval>aeReport.getResponseDescription().getPresentStatus().getDisplayName() == "Recovered/Resolved without Sequelae"</eval>
				<eval>aeReport.getResponseDescription().getPresentStatus().getDisplayName() == "Recovered/Resolved with Sequelae"</eval>
			</or>
			<eval>aeReport.getResponseDescription().getRecoveryDate() == null</eval>
		
		</lhs>
		<rhs>
			<!-- Populate Error Message-->
			errors.addValidationError("DSC_BR1A_ERR","'Date of Recovery or Death' must be provided if 'Present Status' has one of following values:'Fatal/Died','Recovered/Resolved without Sequelae','Recovered/Resolved with Sequelae'");
       </rhs>
	</rule>
</package>