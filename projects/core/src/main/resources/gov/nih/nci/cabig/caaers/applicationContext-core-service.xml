<?xml version="1.0" encoding="UTF-8"?>
<!--
This applicationContext contains the definition of the concrete services
-->
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation=" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd" default-lazy-init="true">
	<tx:annotation-driven proxy-target-class="true"/>
	<!-- ACTUAL SERVICE LAYER -->
	<bean id="participantImportService" class="gov.nih.nci.cabig.caaers.service.ParticipantImportServiceImpl">
		<property name="organizationDao" ref="organizationDao"/>
		<property name="participantRepository" ref="participantRepository"/>
		<property name="participantMigrator" ref="participantMigrator"/>
	</bean>
	<bean id="studyImportService" class="gov.nih.nci.cabig.caaers.service.StudyImportServiceImpl">
		<property name="studyMigrator" ref="studyMigrator"/>
		<property name="studyDao" ref="studyDao"/>
	</bean>
	<bean id="interoperationService" autowire="byType" class="gov.nih.nci.cabig.caaers.service.InteroperationServiceImpl"/>
	<bean id="passwordManagerService" class="gov.nih.nci.cabig.caaers.service.security.PasswordManagerServiceImpl" autowire="byName"/>
	<bean id="passwordPolicyService" class="gov.nih.nci.cabig.caaers.service.security.passwordpolicy.PasswordPolicyServiceImpl" autowire="byName"/>
	<bean id="organizationRepository" lazy-init="true" class="gov.nih.nci.cabig.caaers.domain.repository.OrganizationRepositoryImpl" autowire="byType">
		<property name="csmApplicationContextName" ref="csmApplicationContextName"/>
		<property name="siteObjectIdGenerator" ref="sitePrivilegeAndObjectIdGenerator"/>
		<property name="userProvisioningManager" ref="csmUserProvisioningManager"/>
		<property name="siteProtectionGroupId">
			<!--id for site protection group-->
			<value>-5</value>
		</property>
		<property name="siteAccessRoleId">
			<value>-14</value>
		</property>
	</bean>
	<bean id="delegatedCredentialProvider" class="gov.nih.nci.cabig.caaers.accesscontrol.SecurityContextCredentialProvider"/>
	<bean id="messageBroadcastService" lazy-init="true" class="gov.nih.nci.cabig.caaers.esb.client.impl.CaaersCaXchangeMessageBroadcastServiceImpl">
		<property name="configuration" ref="configuration"/>
		<property name="messageTypesMapping">
			<map>
				<entry key="AENotification" value="SCHEDULE_MODIFICATION"/>
			</map>
		</property>
		<property name="delegatedCredentialProvider" ref="delegatedCredentialProvider"/>
	</bean>
	<bean id="connectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
		<property name="brokerURL" value="tcp://localhost:61616"/>
	</bean>
	<bean id="sendQueueDestination" class="org.apache.activemq.command.ActiveMQQueue">
		<constructor-arg>
			<value>adeers-ae-message.inputQueue</value>
		</constructor-arg>
	</bean>
	<bean id="recvQueueDestination" class="org.apache.activemq.command.ActiveMQQueue">
		<constructor-arg>
			<value>adeers-ae-message.outputQueue</value>
		</constructor-arg>
	</bean>
	<bean id="messageBroadcaster" class="gov.nih.nci.cabig.caaers.esb.client.impl.CaaersAdeersMessageBroadcastServiceImpl">
		<property name="sendQueue">
			<ref bean="sendQueueDestination" />
		</property>
		<property name="recvQueue">
			<ref bean="recvQueueDestination" />
		</property>
		<property name="messageConsumer">
			<ref bean="esbMessageConsumer" />
		</property>
		<property name="configuration" ref="configuration"/>
	</bean>
	<bean id="esbMessageConsumer" class="gov.nih.nci.cabig.caaers.esb.client.ESBMessageConsumerImpl" autowire="byType"/>
	<bean id="messageNotificationService" class="gov.nih.nci.cabig.caaers.esb.client.MessageNotificationService" autowire="byType"/>
	<!-- XXX: may want to put this in a different app context -->
	<bean id="nowFactory" class="gov.nih.nci.cabig.ctms.lang.NowFactory"/>
	<bean id="routineAdverseEventReportServiceImpl" class="gov.nih.nci.cabig.caaers.service.RoutineAdverseEventReportServiceImpl" autowire="byType"/>
	<!--  This bean that implements the service  -->
	<bean id="schedulerService" class="gov.nih.nci.cabig.caaers.service.SchedulerServiceImpl">
		<property name="scheduler">
			<ref bean="schedulerFactory"/>
		</property>
		<!-- The mapping is used to identify the correct job class implementation -->
		<property name="jobClassMapping">
			<map>
				<entry key="gov.nih.nci.cabig.caaers.domain.report.ScheduledEmailNotification" value="gov.nih.nci.cabig.caaers.scheduler.runtime.job.ReminderEmailJob"/>
			</map>
		</property>
		<property name="reportScheduleDao">
			<ref bean="reportDao"/>
		</property>
	</bean>
	<bean id="mailer" class="gov.nih.nci.cabig.caaers.tools.mail.CaaersJavaMailSender">
		<property name="configuration" ref="configuration"/>
	</bean>
	<!-- this is a template message that we can pre-load with default state -->
	<bean id="accountCreatedTemplateMessage" class="org.springframework.mail.SimpleMailMessage">
		<property name="from" value="${outgoing.mail.from.address}"/>
		<property name="subject" value="Account created in caAERS"/>
	</bean>
	<bean id="buildInfo" class="gov.nih.nci.cabig.ctms.tools.BuildInfo">
		<property name="applicationName">
			<value>caAERS</value>
		</property>
		<property name="versionNumber">
			<value>@project.version@</value>
		</property>
		<!-- provided by maven-buildnumber-plugin -->
		<property name="timestamp">
			<value>@buildNumber@</value>
		</property>
	</bean>
	<!--  Migrators -->
	<bean id="identifierMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.IdentifierMigrator">
		<property name="organizationDao" ref="organizationDao" />
	</bean>
	<bean id="studyTherapyMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.StudyTherapyMigrator" />
	<bean id="studyTerminologyMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.StudyTerminologyMigrator">
		<property name="meddraVersionDao" ref="meddraVersionDao" />
		<property name="ctcDao" ref="ctcDao" />
	</bean>
	<bean id="studyDiseaseTerminologyMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.StudyDiseaseTerminologyMigrator" />
	<bean id="studyOrganizationMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.StudyOrganizationMigrator">
		<property name="researchStaffDao" ref="researchStaffDao" />
		<property name="organizationDao" ref="organizationDao" />
		<property name="siteInvestigatorDao" ref="siteInvestigatorDao" />
	</bean>
	<bean id="studyAgentMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.StudyAgentMigrator">
		<property name="agentDao" ref="agentDao" />
		<property name="investigationalNewDrugDao" ref="investigationalNewDrugDao" />
	</bean>
	<bean id="studyDiseaseMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.StudyDiseaseMigrator">
		<property name="diseaseTermDao" ref="diseaseTermDao" />
		<property name="lowLevelTermDao" ref="lowLevelTermDao" />
	</bean>
	<bean id="studyTreatmentMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.TreatmentAssignmentMigrator" />
	<bean id="studyMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.StudyMigrator">
		<constructor-arg>
			<list>
				<ref bean="studyTherapyMigrator"/>
				<ref bean="studyTerminologyMigrator"/>
				<ref bean="studyDiseaseTerminologyMigrator" />
				<ref bean="studyOrganizationMigrator" />
				<ref bean="identifierMigrator" />
				<ref bean="studyAgentMigrator"/>
				<ref bean="studyDiseaseMigrator" />
				<ref bean="studyTreatmentMigrator" />
			</list>
		</constructor-arg>
	</bean>
	<bean id="studyParticipantAssignmentMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.StudyParticipantAssignmentMigrator">
		<property name="studySiteDao" ref="studySiteDao" />
	</bean>
	<bean id="participantMigrator" class="gov.nih.nci.cabig.caaers.service.migrator.ParticipantMigrator">
		<constructor-arg>
			<list>
				<ref bean="identifierMigrator" />
				<ref bean="studyParticipantAssignmentMigrator" />
			</list>
		</constructor-arg>
	</bean>
	
	<bean id="studyProcessor" class="gov.nih.nci.cabig.caaers.service.migrator.StudyProcessor">
		<property name="studyImportService" ref="studyImportService" />
		<property name="studyConverter" ref="studyConverter" />
		<property name="studyDao" ref="studyDao" />
		<property name="studySynchronizer" ref="studySynchronizer" />
	</bean>
	<bean id="studyConverter" class="gov.nih.nci.cabig.caaers.service.migrator.StudyConverter"/>	
	
	<bean id="identifierSynchronizer" class="gov.nih.nci.cabig.caaers.service.synchronizer.IdentifierSynchronizer"/>
	<bean id="treatmentAssignmentSynchronizer" class="gov.nih.nci.cabig.caaers.service.synchronizer.TreatmentAssignmentSynchronizer"/>
	<bean id="studyDiseasesSynchronizer" class="gov.nih.nci.cabig.caaers.service.synchronizer.StudyDiseasesSynchronizer"/>
	<bean id="studyOrganizationSynchronizer" class="gov.nih.nci.cabig.caaers.service.synchronizer.StudyOrganizationSynchronizer"/>
	<bean id="studyTherapySynchronizer" class="gov.nih.nci.cabig.caaers.service.synchronizer.StudyTherapySynchronizer"/>



	<bean id="studySynchronizer" class="gov.nih.nci.cabig.caaers.service.synchronizer.StudySynchronizer">
		<constructor-arg>
			<list>
				<ref bean="identifierSynchronizer"/>
				<ref bean="treatmentAssignmentSynchronizer"/>
				<ref bean="studyDiseasesSynchronizer"/>
				<ref bean="studyOrganizationSynchronizer"/>
				<ref bean="studyTherapySynchronizer"/>
			</list>
		</constructor-arg>
	</bean>
	<bean id="investigatorMigratorService" class="gov.nih.nci.cabig.caaers.api.impl.DefaultInvestigatorMigratorService"/>
	<bean id="researchStaffMigratorService" class="gov.nih.nci.cabig.caaers.api.impl.DefaultResearchStaffMigratorService"/>
	
</beans>